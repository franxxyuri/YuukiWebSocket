# Windows-Android Connect 开发指南

## 🚀 快速开始

### 环境要求

#### Windows端开发环境
- **Node.js**: 18.x 或更高版本
- **npm**: 9.x 或更高版本  
- **Git**: 最新版本
- **Visual Studio Code**: 推荐编辑器

#### Android端开发环境
- **Android Studio**: 最新版本
- **JDK**: 11 或更高版本
- **Android SDK**: API 24 (Android 7.0) 或更高版本
- **Kotlin**: 1.8.x 或更高版本

### 安装步骤

#### 1. 克隆项目
```bash
# 克隆项目（如果使用Git）
git clone https://github.com/your-username/windows-android-connect.git
cd windows-android-connect
```

#### 2. 安装Windows端依赖
```bash
# 安装根项目依赖
npm install

# 进入Windows客户端目录并安装依赖
cd windows-client
npm install

# 或者使用项目根目录的命令
npm run install:client
```

#### 3. 验证安装
```bash
# 检查Node.js版本
node --version

# 检查npm版本
npm --version

# 安装依赖
npm install
```

### 开发运行

#### 开发模式（推荐）
```bash
# 使用 concurrently 同时运行 Electron 和 React 开发服务器
npm run dev

# 或者分别运行
npm run start:renderer  # 运行React开发服务器
npm run start          # 运行Electron应用
```

#### 生产构建
```bash
# 构建React应用
npm run build

# 打包为桌面应用
npm run package
```

## 📁 项目结构

```
windows-android-connect/
├── electron-main.js          # Electron主进程入口
├── electron-preload.js       # 预加载脚本
├── app-index.html            # 基础HTML入口
├── react-index.html          # React HTML入口
├── react-main.jsx            # React入口组件
├── React-App.jsx             # 主应用组件
├── app-styles.css            # 样式文件
├── vite.config.js            # Vite配置
├── tsconfig.json             # TypeScript配置
├── package.json              # 根项目配置
├── windows-client-package.json # Windows客户端配置
├── 技术架构设计.md             # 技术架构文档
├── 开发指南.md                # 本文件
└── README.md                # 项目说明
```

## 🔧 开发工作流

### 日常开发
1. **启动开发环境**
   ```bash
   npm run dev
   ```

2. **修改代码**
   - 编辑React组件 (App.jsx)
   - 修改主进程代码 (electron-main.js)
   - 调整样式 (app-styles.css)

3. **热重载**
   - React代码修改会自动重载
   - Electron代码修改需要重启应用

### 代码规范
- **TypeScript**: 所有新代码建议使用TypeScript
- **ESLint**: 运行 `npm run lint` 检查代码规范
- **Prettier**: 建议配置自动格式化

## 🎯 当前功能状态

### ✅ 已完成功能
- [x] 基础Electron应用框架
- [x] React + Ant Design UI组件
- [x] 设备发现界面（模拟数据）
- [x] 连接管理界面
- [x] 屏幕投屏控制界面
- [x] 基础的IPC通信机制

### 🚧 开发中功能
- [ ] 真实的设备发现和连接
- [ ] 文件传输实现
- [ ] 屏幕投屏技术实现
- [ ] 远程控制功能
- [ ] 通知同步功能
- [ ] 剪贴板同步功能

### 📋 待实现功能
- [ ] Android客户端开发
- [ ] 安全加密机制
- [ ] 性能优化
- [ ] 稳定性测试
- [ ] 打包发布

## 🛠️ 核心模块详解

### 1. Electron主进程 (electron-main.js)
负责应用生命周期管理、系统集成、IPC处理。

**关键功能**:
- 窗口管理 (WindowManager)
- 设备发现 (DeviceDiscovery)  
- 文件传输 (FileTransfer)
- IPC通信处理

**重要API**:
```javascript
// 设备发现
ipcMain.handle('start-device-discovery')
ipcMain.handle('stop-device-discovery')

// 文件传输
ipcMain.handle('send-file')
ipcMain.handle('receive-file')

// 屏幕控制
ipcMain.handle('capture-screen')
ipcMain.handle('stop-screen-capture')
```

### 2. 预加载脚本 (electron-preload.js)
在渲染进程和主进程之间建立安全的桥梁。

**主要职责**:
- 暴露安全的API给渲染进程
- 处理权限控制
- 防止渲染进程直接访问Node.js

### 3. React应用 (React-App.jsx)
主用户界面，负责用户交互和状态管理。

**关键组件**:
- 设备列表管理
- 连接状态控制
- 文件传输界面
- 屏幕投屏控制

### 4. IPC通信机制
主进程和渲染进程之间的通信桥梁。

**通信模式**:
- **请求-响应**: 使用 `ipcRenderer.invoke/ipcMain.handle`
- **事件通知**: 使用 `ipcRenderer.on/ipcMain.emit`

## 🔍 调试指南

### 开发模式调试
1. **打开开发者工具**
   - 在Electron中按F12
   - 或在菜单栏选择"开发者工具"

2. **主进程调试**
   - 在主进程中设置断点
   - 检查主进程日志

3. **渲染进程调试**
   - 使用Chrome开发者工具
   - React DevTools支持

### 日志查看
```javascript
// 主进程日志
console.log('主进程日志');

// 渲染进程日志  
console.log('渲染进程日志');

// IPC通信日志
ipcMain.handle('test', (event, data) => {
  console.log('收到IPC请求:', data);
  return result;
});
```

## 🧪 测试

### 单元测试
```bash
# 运行测试
npm run test

# 类型检查
npm run type-check

# 代码检查
npm run lint
```

### 手动测试清单
- [ ] 应用启动正常
- [ ] UI响应良好
- [ ] 设备发现功能
- [ ] 连接/断开功能
- [ ] 文件传输测试
- [ ] 屏幕投屏测试

## 🚀 打包发布

### Windows打包
```bash
# 构建并打包
npm run package:win
```

### 打包输出
- 可执行文件: `dist-electron/`
- 安装包: `dist-electron/Windows-Android Connect Setup.exe`

### 自动更新
当前版本使用手动更新，后续版本将集成自动更新功能。

## 📚 开发资源

### 相关文档
- [Electron官方文档](https://electronjs.org/docs)
- [React官方文档](https://reactjs.org/docs)
- [Ant Design组件库](https://ant.design/components/overview)
- [Vite构建工具](https://vitejs.dev/guide/)
- [TypeScript文档](https://www.typescriptlang.org/docs/)

### 参考项目
- [Electron React Boilerplate](https://github.com/electron-react-boilerplate/electron-react-boilerplate)
- [Scrcpy源码](https://github.com/Genymobile/scrcpy)
- [ToDesk源码分析](https://github.com/todesk)

## 🤝 贡献指南

### 代码提交
1. 创建功能分支
2. 完成功能开发
3. 运行测试和检查
4. 提交Pull Request

### 代码规范
- 使用TypeScript进行类型检查
- 遵循ESLint配置
- 添加必要的注释
- 编写单元测试

### 问题报告
- 使用GitHub Issues报告问题
- 提供详细的重现步骤
- 包含系统环境信息
- 附加相关截图或日志

## 🔄 开发路线图

### Phase 1: 基础框架 (当前阶段)
- [x] Electron + React框架搭建
- [x] 基础UI界面
- [x] IPC通信机制
- [ ] 真实设备发现功能
- [ ] 基础连接功能

### Phase 2: 核心功能
- [ ] 文件传输功能
- [ ] 屏幕投屏技术实现
- [ ] 远程控制功能
- [ ] Android客户端开发

### Phase 3: 完善功能
- [ ] 通知同步功能
- [ ] 剪贴板同步功能
- [ ] 安全加密机制
- [ ] 性能优化

### Phase 4: 发布准备
- [ ] 稳定性测试
- [ ] 性能优化
- [ ] 用户体验优化
- [ ] 打包发布准备

## 💡 开发技巧

### 性能优化
1. **减少IPC调用**: 批量处理数据
2. **内存管理**: 及时释放资源
3. **渲染优化**: 使用React.memo和useMemo

### 错误处理
1. **全局错误捕获**: 在主进程和渲染进程分别处理
2. **用户友好提示**: 将技术错误转换为用户可理解的提示
3. **日志记录**: 记录详细错误信息用于调试

### 安全性考虑
1. **权限最小化**: 只暴露必要的API
2. **输入验证**: 验证所有用户输入
3. **安全通信**: 使用加密传输敏感数据

---

**当前开发状态**: Phase 1 - 基础框架搭建中
**预计完成时间**: 根据开发进度持续更新
**技术支持**: 通过GitHub Issues获取支持
