# Windows-Android Connect 端口配置说明

## 概述
本文档记录了Windows-Android Connect项目中使用的各种端口号及其用途，方便开发和维护。

## 端口配置详情

### 主要服务端口

| 端口号 | 用途 | 协议 | 说明 |
|--------|------|------|------|
| 8828 | WebSocket主服务端口 | TCP | 主要的WebSocket通信端口，用于Android客户端与Windows服务端之间的双向通信 |
| 8090 | 设备发现服务端口 | UDP | 用于局域网内的设备自动发现功能 |
| 8080 | Vite开发服务器端口 | TCP | 提供React前端界面和静态资源，包含WebSocket代理 |

### 客户端配置

#### Android客户端
- **连接端口**: 8828
- **通信协议**: WebSocket
- **配置文件**: 
  - `MainActivity.kt` 
  - `NetworkCommunication.kt` 

#### Web客户端 (Vite)

- **访问端口**: 8080

- **代理端口**: 通过代理将WebSocket请求转发到8828端口

- **配置文件**: 

  - `vite-config.js` - 配置代理设置

  - `src/services/websocket-service.js` - 配置前端WebSocket连接

## 过时文件说明

以下文件使用了旧的端口配置，已重命名为`.old`扩展名以避免冲突：
- `device-discovery.js.old` - 原使用8080端口
- `integrated-server.js.old` - 原使用8080/8827端口
- `full-integrated-server.js.old` - 原使用8080/8827端口
- `test-client.js.old` - 原连接到8080端口

当前正在使用的正确配置文件：
- `complete-server.js` - 使用8828端口(WebSocket)和8090端口(设备发现)
- `integrated-vite-server.js` - 集成Windows主服务和Vite开发服务器
- `test-server-functions.html` - 服务端功能测试页面
- `test-server-functions.js` - 服务端功能测试脚本

## 配置修改记录

### 2025年11月16日
- 添加Vite服务器代理配置，将/ws请求代理到8828端口
- 更新启动说明文档
- 重命名过时的JS文件以避免端口冲突
- 涉及文件：
  - `vite-config.js`
  - `src/services/websocket-service.js`
  - `启动说明-更新版.md`

### 2025年11月17日
- 将Vite开发服务器端口从3000改为8080
- 更新相关配置文件以使用新的端口号
- 涉及文件：
  - `vite-config.js`
  - `start-vite-server.js`
  - `src/App.jsx`
  - `package.json`
  - `端口配置说明.md` (当前文件)

### 2025年11月17日 (最新更新)
- 创建服务端功能测试页面 `test-server-functions.html`
- 创建服务端功能测试脚本 `test-server-functions.js`
- 添加测试脚本到 package.json 中的 scripts 部分
- 更新端口配置说明文档，添加测试工具部分

## 测试工具

### 服务端测试页面
- **访问地址**: http://localhost:8080/test-server-functions.html
- **功能**: 用于测试服务端各项功能，包括WebSocket通信、API接口、设备发现等
- **文件**: `test-server-functions.html`

### 测试脚本
- **命令**: `npm run test:server` 或 `node test-server-functions.js`
- **功能**: 命令行测试服务端HTTP API和WebSocket功能

## 注意事项

1. 修改端口号时需要同时更新服务端和客户端的配置
2. 确保防火墙允许相应端口的通信
3. 局域网内的设备需要使用相同的端口配置才能正常通信
4. 端口冲突时需要选择未被占用的端口号
5. Vite服务器(8080端口)通过代理将WebSocket请求转发到后端服务器(8828端口)
6. 避免使用已重命名为`.old`的过时配置文件
7. 测试页面和脚本仅用于开发和调试，请勿在生产环境中使用

## 故障排查

当出现连接问题时，按以下步骤检查：

1. 确认后端服务器已启动并监听8828端口
2. 确认Vite服务器已启动并监听8080端口
3. 检查代理配置是否正确
4. 检查客户端配置的IP地址和端口号是否正确
5. 验证网络连通性（ping测试）
6. 检查防火墙设置是否阻止了端口通信
7. 确认端口未被其他程序占用
8. 确保没有使用已重命名的过时配置文件
9. 使用测试页面验证服务端功能是否正常