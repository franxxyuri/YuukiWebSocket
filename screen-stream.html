<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows-Android Connect</title>
    

    <style>

        body {

            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;

            margin: 0;

            padding: 20px;

            background-color: #f5f5f5;

        }

        

        .container {

            max-width: 1200px;

            margin: 0 auto;

        }

        

        header {

            text-align: center;

            margin-bottom: 30px;

        }

        

        h1 {

            color: #333;

        }

        

        .status-bar {

            background-color: #fff;

            padding: 15px;

            border-radius: 8px;

            box-shadow: 0 2px 4px rgba(0,0,0,0.1);

            margin-bottom: 20px;

        }

        

        .device-list {

            display: flex;

            flex-wrap: wrap;

            gap: 20px;

            margin-bottom: 30px;

        }

        

        .device-card {

            background-color: #fff;

            border-radius: 8px;

            padding: 20px;

            box-shadow: 0 2px 4px rgba(0,0,0,0.1);

            flex: 1;

            min-width: 300px;

        }

        

        .device-card h3 {

            margin-top: 0;

            color: #333;

        }

        

        .device-card.connected {

            border-left: 5px solid #4CAF50;

        }

        

        .device-card.disconnected {

            border-left: 5px solid #f44336;

        }

        

        .controls {

            display: grid;

            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));

            gap: 20px;

            margin-bottom: 30px;

        }

        

        .control-panel {

            background-color: #fff;

            border-radius: 8px;

            padding: 20px;

            box-shadow: 0 2px 4px rgba(0,0,0,0.1);

        }

        

        .control-panel h3 {

            margin-top: 0;

            color: #333;

        }

        

        .button-group {

            display: flex;

            flex-wrap: wrap;

            gap: 10px;

            margin-bottom: 15px;

        }

        

        button {

            padding: 10px 15px;

            border: none;

            border-radius: 4px;

            cursor: pointer;

            font-weight: bold;

            transition: background-color 0.3s;

        }

        

        .btn-primary {

            background-color: #2196F3;

            color: white;

        }

        

        .btn-primary:hover {

            background-color: #1976D2;

        }

        

        .btn-success {

            background-color: #4CAF50;

            color: white;

        }

        

        .btn-success:hover {

            background-color: #388E3C;

        }

        

        .btn-danger {

            background-color: #f44336;

            color: white;

        }

        

        .btn-danger:hover {

            background-color: #D32F2F;

        }

        

        .btn-warning {

            background-color: #FF9800;

            color: white;

        }

        

        .btn-warning:hover {

            background-color: #F57C00;

        }

        

        .screen-display {

            background-color: #000;

            border-radius: 8px;

            overflow: hidden;

            position: relative;

            min-height: 400px;

            display: flex;

            align-items: center;

            justify-content: center;

            color: white;

        }

        

        .screen-placeholder {

            text-align: center;

        }

        

        .progress-bar {

            width: 100%;

            height: 20px;

            background-color: #e0e0e0;

            border-radius: 10px;

            overflow: hidden;

            margin-top: 10px;

        }

        

        .progress-fill {

            height: 100%;

            background-color: #4CAF50;

            width: 0%;

            transition: width 0.3s;

        }

        

        .log-area {

            background-color: #fff;

            border-radius: 8px;

            padding: 20px;

            box-shadow: 0 2px 4px rgba(0,0,0,0.1);

            height: 200px;

            overflow-y: auto;

            font-family: monospace;

            font-size: 14px;

        }

        

        .log-entry {

            margin-bottom: 5px;

        }

        

        .log-info {

            color: #2196F3;

        }

        

        .log-success {

            color: #4CAF50;

        }

        

        .log-error {

            color: #f44336;

        }

        

        .log-warning {

            color: #FF9800;

        }

    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Windows-Android Connect</h1>
            <p>局域网内的设备互联工具</p>
        </header>
        
        <div class="status-bar">
            <h2>连接状态</h2>
            <p id="connection-status">正在连接到服务器...</p>
        </div>
        
        <div class="device-list">
            <div class="device-card disconnected" id="android-device">
                <h3>Android设备</h3>
                <p>状态: <span id="android-status">未连接</span></p>
                <p>设备名称: <span id="android-name">-</span></p>
                <p>IP地址: <span id="android-ip">-</span></p>
            </div>
            
            <div class="device-card disconnected" id="windows-device">
                <h3>Windows设备</h3>
                <p>状态: <span id="windows-status">已连接</span></p>
                <p>设备名称: <span id="windows-name">-</span></p>
                <p>IP地址: <span id="windows-ip">-</span></p>
            </div>
        </div>
        
        <div class="controls">
            <div class="control-panel">
                <h3>设备控制</h3>
                <div class="button-group">
                    <button class="btn-primary" id="connect-btn">连接设备</button>
                    <button class="btn-danger" id="disconnect-btn">断开连接</button>
                </div>
                
                <h3>文件传输</h3>
                <div class="button-group">
                    <button class="btn-primary" id="send-file-btn">发送文件</button>
                    <button class="btn-warning" id="receive-file-btn">接收文件</button>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="file-progress"></div>
                </div>
                <p>传输进度: <span id="progress-text">0%</span></p>
            </div>
            
            <div class="control-panel">
                <h3>远程控制</h3>
                <div class="button-group">
                    <button class="btn-primary" id="mouse-mode-btn">鼠标模式</button>
                    <button class="btn-warning" id="keyboard-mode-btn">键盘模式</button>
                </div>
                <p>控制状态: <span id="control-status">未激活</span></p>
                
                <h3>同步功能</h3>
                <div class="button-group">
                    <button class="btn-success" id="clipboard-sync-btn">同步剪贴板</button>
                    <button class="btn-primary" id="notification-btn">查看通知</button>
                </div>
            </div>
        </div>
        
        <div class="control-panel">
            <h3>屏幕投屏</h3>
            <div class="screen-display">
                <div class="screen-placeholder" id="screen-placeholder">
                    <p>屏幕投屏区域</p>
                    <p>连接设备后将显示Android屏幕</p>
                </div>
                <canvas id="screen-canvas" style="display: none; width: 100%; height: 100%;"></canvas>
            </div>
            <div class="button-group">
                <button class="btn-success" id="start-screen-btn">开始投屏</button>
                <button class="btn-danger" id="stop-screen-btn">停止投屏</button>
            </div>
        </div>
        
        <div class="control-panel">
            <h3>系统日志</h3>
            <div class="log-area" id="log-area">
                <div class="log-entry log-info">系统启动中...</div>
            </div>
        </div>
    </div>

    <script>
        // WebSocket连接
        let ws = null;
        let androidDevice = null;
        
        // DOM元素
        const elements = {
            connectionStatus: document.getElementById('connection-status'),
            androidStatus: document.getElementById('android-status'),
            androidName: document.getElementById('android-name'),
            androidIp: document.getElementById('android-ip'),
            windowsName: document.getElementById('windows-name'),
            windowsIp: document.getElementById('windows-ip'),
            connectBtn: document.getElementById('connect-btn'),
            disconnectBtn: document.getElementById('disconnect-btn'),
            sendFileBtn: document.getElementById('send-file-btn'),
            receiveFileBtn: document.getElementById('receive-file-btn'),
            fileProgress: document.getElementById('file-progress'),
            progressText: document.getElementById('progress-text'),
            mouseModeBtn: document.getElementById('mouse-mode-btn'),
            keyboardModeBtn: document.getElementById('keyboard-mode-btn'),
            controlStatus: document.getElementById('control-status'),
            clipboardSyncBtn: document.getElementById('clipboard-sync-btn'),
            notificationBtn: document.getElementById('notification-btn'),
            startScreenBtn: document.getElementById('start-screen-btn'),
            stopScreenBtn: document.getElementById('stop-screen-btn'),
            screenPlaceholder: document.getElementById('screen-placeholder'),
            screenCanvas: document.getElementById('screen-canvas'),
            logArea: document.getElementById('log-area')
        };
        
        // 连接到WebSocket服务器

        function connectToServer() {

            // 根据当前页面URL决定WebSocket连接地址

            const isViteDevServer = window.location.port === '8080';

            const wsUrl = isViteDevServer ? 'ws://localhost:8080/ws' : 'ws://localhost:8828';

            

            // 使用原生WebSocket连接

            ws = new WebSocket(wsUrl);



            ws.onopen = function(event) {

                log('已连接到服务器: ' + wsUrl, 'success');

                elements.connectionStatus.textContent = '已连接到服务器: ' + wsUrl;

                elements.connectionStatus.style.color = '#4CAF50';

                

                // 发送设备信息（模拟Web客户端）

                ws.send(JSON.stringify({

                    type: 'device_info',

                    deviceInfo: {

                        platform: 'web',

                        deviceName: 'Screen Stream Web Client',

                        deviceId: 'web-screen-' + Date.now()

                    }

                }));

            };



            ws.onclose = function(event) {

                log('与服务器断开连接: ' + wsUrl, 'error');

                elements.connectionStatus.textContent = '与服务器断开连接: ' + wsUrl;

                elements.connectionStatus.style.color = '#f44336';

            };



            ws.onerror = function(error) {

                log('WebSocket连接错误: ' + error.message + ' (URL: ' + wsUrl + ')', 'error');

            };



            ws.onmessage = function(event) {

                try {

                    const message = JSON.parse(event.data);

                    handleMessage(message);

                } catch (e) {

                    log('消息解析错误: ' + e.message, 'error');

                }

            };

        }
        
                // 处理接收到的消息

        function handleMessage(message) {

            switch (message.type) {

                case 'connection_established':

                    log('连接已建立，客户端ID: ' + message.clientId, 'success');

                    break;

                    

                case 'device_connected':

                    handleDeviceConnected(message.deviceInfo);

                    break;

                    

                case 'screen_frame':

                    handleScreenFrame(message);

                    break;

                    

                case 'file_transfer':

                    handleFileTransfer(message);

                    break;

                    

                case 'clipboard':

                    handleClipboard(message);

                    break;

                    

                case 'notification':

                    handleNotification(message);

                    break;

                    

                default:

                    log('收到未知消息类型: ' + message.type, 'warning');

                    break;

            }

        }
        
        // 处理设备连接
        function handleDeviceConnected(deviceInfo) {
            if (deviceInfo.platform === 'android') {
                androidDevice = deviceInfo;
                
                elements.androidStatus.textContent = '已连接';
                elements.androidStatus.style.color = '#4CAF50';
                elements.androidName.textContent = deviceInfo.deviceName;
                elements.androidIp.textContent = deviceInfo.ip;
                
                document.getElementById('android-device').className = 'device-card connected';
                
                log('Android设备已连接: ' + deviceInfo.deviceName, 'success');
            }
        }
        
        // 处理屏幕帧
        function handleScreenFrame(message) {
            // 简化处理，实际应用中需要解码图像数据
            log('收到屏幕帧数据', 'info');
        }
        
        // 处理文件传输
        function handleFileTransfer(message) {
            switch (message.action) {
                case 'start':
                    log('开始文件传输: ' + message.fileName, 'info');
                    break;
                case 'chunk':
                    updateProgress(message.progress);
                    break;
                case 'complete':
                    log('文件传输完成: ' + message.fileName, 'success');
                    updateProgress(100);
                    break;
                case 'error':
                    log('文件传输错误: ' + message.error, 'error');
                    break;
            }
        }
        
        // 处理剪贴板同步
        function handleClipboard(message) {
            log('剪贴板内容已同步: ' + message.data.substring(0, 50) + '...', 'info');
        }
        
        // 处理通知
        function handleNotification(message) {
            if (message.action === 'posted') {
                log('收到通知: ' + message.title, 'info');
            }
        }
        
        // 更新进度条
        function updateProgress(percent) {
            elements.fileProgress.style.width = percent + '%';
            elements.progressText.textContent = percent + '%';
        }
        
        // 发送控制命令

        function sendControlCommand(command) {

            if (!ws || ws.readyState !== WebSocket.OPEN) {

                log('WebSocket未连接', 'error');

                return;

            }

            

            if (!androidDevice) {

                log('没有连接的Android设备', 'error');

                return;

            }

            

            const message = {

                type: 'control_command',

                ...command

            };

            

            ws.send(JSON.stringify(message));

            log('发送控制命令: ' + command.commandType, 'info');

        }
        
        // 日志记录
        function log(message, type = 'info') {
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry log-' + type;
            logEntry.textContent = '[' + new Date().toLocaleTimeString() + '] ' + message;
            
            elements.logArea.appendChild(logEntry);
            elements.logArea.scrollTop = elements.logArea.scrollHeight;
        }
        
        // 事件监听器
        function setupEventListeners() {
            // 连接/断开连接按钮
            elements.connectBtn.addEventListener('click', function() {
                log('正在搜索Android设备...', 'info');
                // 实际应用中会发送设备发现请求
            });
            
            elements.disconnectBtn.addEventListener('click', function() {
                if (androidDevice) {
                    log('已断开与 ' + androidDevice.deviceName + ' 的连接', 'info');
                    androidDevice = null;
                    elements.androidStatus.textContent = '未连接';
                    elements.androidStatus.style.color = '#f44336';
                    elements.androidName.textContent = '-';
                    elements.androidIp.textContent = '-';
                    document.getElementById('android-device').className = 'device-card disconnected';
                }
            });
            
            // 文件传输按钮
            elements.sendFileBtn.addEventListener('click', function() {
                if (!androidDevice) {
                    log('请先连接Android设备', 'error');
                    return;
                }
                log('选择文件进行传输...', 'info');
                // 实际应用中会打开文件选择对话框
            });
            
            elements.receiveFileBtn.addEventListener('click', function() {
                if (!androidDevice) {
                    log('请先连接Android设备', 'error');
                    return;
                }
                log('准备接收文件...', 'info');
            });
            
            // 远程控制按钮
            elements.mouseModeBtn.addEventListener('click', function() {
                elements.controlStatus.textContent = '鼠标模式已激活';
                log('激活鼠标控制模式', 'info');
            });
            
            elements.keyboardModeBtn.addEventListener('click', function() {
                elements.controlStatus.textContent = '键盘模式已激活';
                log('激活键盘控制模式', 'info');
            });
            
            // 同步功能按钮
            elements.clipboardSyncBtn.addEventListener('click', function() {
                log('同步剪贴板内容...', 'info');
                // 实际应用中会发送剪贴板同步请求
            });
            
            elements.notificationBtn.addEventListener('click', function() {
                log('查看通知历史...', 'info');
            });
            
            // 屏幕投屏按钮
            elements.startScreenBtn.addEventListener('click', function() {
                if (!androidDevice) {
                    log('请先连接Android设备', 'error');
                    return;
                }
                
                // 发送开始屏幕投屏命令
                sendControlCommand({
                    commandType: 'screen_stream',
                    action: 'start'
                });
                
                elements.screenPlaceholder.style.display = 'none';
                elements.screenCanvas.style.display = 'block';
                log('开始屏幕投屏...', 'info');
            });
            
            elements.stopScreenBtn.addEventListener('click', function() {
                // 发送停止屏幕投屏命令
                sendControlCommand({
                    commandType: 'screen_stream',
                    action: 'stop'
                });
                
                elements.screenPlaceholder.style.display = 'block';
                elements.screenCanvas.style.display = 'none';
                log('停止屏幕投屏', 'info');
            });
        }
        
        // 初始化应用
        function init() {
            log('应用启动中...', 'info');
            
            // 设置事件监听器
            setupEventListeners();
            
            // 连接到服务器
            connectToServer();
            
            // 获取Windows设备信息
            elements.windowsName.textContent = navigator.platform;
            elements.windowsIp.textContent = window.location.hostname;
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>