# Windows-Android Connect 系统架构图

## 架构总览

```mermaid
graph TD
    subgraph "局域网环境"
        subgraph "Windows PC"
            A[Windows服务端] -->|监听端口| A1[(8828 WebSocket)]
            A -->|监听端口| A2[(8090 UDP广播)]
            B[Vite开发服务器] -->|监听端口| B1[(8080 HTTP)]
            B -->|代理| A
        end
        
        subgraph "Android设备"
            C[Android客户端]
            C -->|连接| A1
            C -->|UDP广播| A2
        end
        
        subgraph "Web浏览器"
            D[Web前端]
            D -->|连接| B1
        end
    end
    
    style A fill:#cde4ff,stroke:#6495ED,stroke-width:2px
    style B fill:#cde4ff,stroke:#6495ED,stroke-width:2px
    style C fill:#cde4ff,stroke:#6495ED,stroke-width:2px
    style D fill:#cde4ff,stroke:#6495ED,stroke-width:2px
    style A1 fill:#ffa07a,stroke:#ff6347,stroke-width:2px
    style A2 fill:#ffa07a,stroke:#ff6347,stroke-width:2px
    style B1 fill:#ffa07a,stroke:#ff6347,stroke-width:2px
```

## 详细组件交互

```mermaid
sequenceDiagram
    participant Android as Android客户端
    participant Windows as Windows服务端
    participant Vite as Vite开发服务器
    participant Web as Web前端
    
    %% 设备发现阶段
    Android->>Windows: UDP广播(8090端口) - 设备信息
    Windows->>Web: WebSocket广播 - 发现Android设备
    
    %% 连接建立阶段
    Android->>Windows: WebSocket连接(8828端口)
    Windows->>Android: 发送连接确认消息
    Android->>Windows: 发送设备信息
    
    %% Web前端连接
    Web->>Vite: HTTP请求(8080端口)
    Vite->>Web: 提供静态资源
    Web->>Vite: WebSocket连接(/ws路径)
    Vite->>Windows: 代理WebSocket到8828端口
    
    %% 功能交互阶段
    Note over Android,Windows: 屏幕镜像
    Android->>Windows: 发送屏幕帧数据
    Windows->>Web: 广播屏幕帧
    
    Note over Web,Windows: 远程控制
    Web->>Windows: 发送控制命令
    Windows->>Android: 转发控制命令
    Android->>Windows: 发送执行结果
    Windows->>Web: 返回执行结果
    
    Note over Android,Windows: 文件传输
    Web->>Windows: 请求文件传输
    Windows->>Android: 转发传输请求
    Android->>Windows: 发送文件数据
    Windows->>Web: 转发文件数据
    
    Note over Android,Windows: 通知同步
    Android->>Windows: 发送通知消息
    Windows->>Web: 广播通知消息
    
    Note over Android,Windows: 剪贴板同步
    Android->>Windows: 发送剪贴板内容
    Windows->>Web: 广播剪贴板内容
    Web->>Windows: 发送剪贴板内容
    Windows->>Android: 转发剪贴板内容
```

## 数据流向图

```mermaid
flowchart LR
    subgraph 数据流向
        direction LR
        
        subgraph Android客户端
            A1[屏幕捕获] --> A2[WebSocket发送]
            A3[文件读取] --> A4[文件传输]
            A5[通知监听] --> A6[通知发送]
            A7[剪贴板监听] --> A8[剪贴板发送]
        end
        
        subgraph 传输层
            T1[8828 WebSocket]
            T2[8090 UDP广播]
            T3[8080 HTTP/WS代理]
        end
        
        subgraph Windows服务端
            W1[WebSocket接收] --> W2[消息处理]
            W3[UDP接收] --> W4[设备发现]
            W2 --> W5[消息广播]
        end
        
        subgraph Vite服务器
            V1[HTTP服务] --> V2[静态资源]
            V3[WebSocket代理] --> V4[转发到8828]
        end
        
        subgraph Web前端
            F1[WebSocket接收] --> F2[UI更新]
            F3[用户操作] --> F4[命令发送]
        end
        
        A2 --> T1
        T1 --> W1
        W5 --> T1
        T1 --> V3
        V3 --> T3
        T3 --> F1
        F4 --> T3
        T3 --> V3
        V3 --> T1
        T1 --> W2
        W2 --> A2
        
        A4 --> T1
        A6 --> T1
        A8 --> T1
        F3 --> T3
    end
    
    style A1 fill:#98fb98
    style A2 fill:#98fb98
    style A3 fill:#98fb98
    style A4 fill:#98fb98
    style A5 fill:#98fb98
    style A6 fill:#98fb98
    style A7 fill:#98fb98
    style A8 fill:#98fb98
    style W1 fill:#87ceeb
    style W2 fill:#87ceeb
    style W3 fill:#87ceeb
    style W4 fill:#87ceeb
    style W5 fill:#87ceeb
    style F1 fill:#dda0dd
    style F2 fill:#dda0dd
    style F3 fill:#dda0dd
    style F4 fill:#dda0dd
    style V1 fill:#f0e68c
    style V2 fill:#f0e68c
    style V3 fill:#f0e68c
    style V4 fill:#f0e68c
```

## 端口配置说明

| 组件 | 端口 | 协议 | 用途 |
|------|------|------|------|
| Windows主服务 | 8828 | WebSocket | 客户端连接和消息处理 |
| 设备发现服务 | 8090 | UDP | 局域网内设备自动发现 |
| Vite开发服务器 | 8080 | HTTP/WS | Web前端访问和代理 |

## 连接关系

1. **Android客户端** ↔ **Windows服务端** (8828端口 WebSocket)
2. **Android客户端** ↔ **Windows服务端** (8090端口 UDP广播)
3. **Web前端** ↔ **Vite服务器** (8080端口 HTTP/WS)

4. **Vite服务器** ↔ **Windows服务端** (代理到8828端口)